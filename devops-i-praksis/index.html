<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>DevOps i Praksis</title>

    <meta name="description" content="“Real developers carry beepers”">
    <meta name="author" content="Stein Inge Morisbak">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="../css/reveal.min.css">
    <!-- <link rel="stylesheet" href="../css/theme/default.css" id="theme"> -->

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="../lib/css/zenburn.css">

    <!-- BEKK Theme -->
    <link rel="stylesheet" href="../css/theme/bekk.css" id="theme">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="../css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>


    <div class="reveal">

      <div class="slides">

        <section>
        <h2>DevOps i Praksis</h2>
        </section>

        <section>
        <img width="615" height="461" src="img/worked-fine-in-dev.jpg" alt="worked fine in dev - ops problem now">
        </section>

        <section>
        <h2>Scope</h2>
        <a href="http://bekkopen.github.io/maturity-model/">Modenhetsmodellen</a>
        <img width="776" height="222" src="img/scope.png" alt="scope">
        <aside class="notes"> </aside>
        </section>

        <section>
        <h2>Hva er konfigurasjon som kode?</h2>
        <ul>
          <li>Automatisert oppsett av servere</li>
          <li>Konfigurasjon som kode</li>
        </ul>
        <aside class="notes"> </aside>
        </section>

        <section>
        <h2>Eksempler</h2>
        <ul>
          <li>Lag brukere</li>
          <li>Installer software</li>
          <li>Generer og endre konfigurasjonsfiler</li>
          <li>Start/stop/restart prosesser</li>
          <li>Sett opp avhengigheter mellom operasjoner</li>
        </ul>
        <aside class="notes"> </aside>
        </section>
        <section>
          <h2>Deskriptivt (lag en oppskrift)</h2>
          <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
#!/bin/bash

if $( command -v vim &gt;/dev/null 2&gt;&amp;1 ); then
  echo "vim is already installed."
else
  apt-get install vim
fi

if $( grep -Fxq "filetype indent off" /etc/vim/vimrc ); then
  echo "set filetype indent off is already in /etc/vim/vimrc."
else
  echo "filetype indent off" &gt;&gt; /etc/vim/vimrc
  # TODO: Do not continue if this fails.
fi

# TODO: Rollback if something fails.
          </code></pre>
        </section>
        <section>
            <h2>Deklarativt (beskriv tilstand)</h2>
            <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
- name: ensure installed vim
  apt: pkg=vim state=installed

- name: set filetype indent off for vim
  lineinfile:
    dest=/etc/vim/vimrc
    line='filetype indent off'
    state=present

          </code></pre>
            <aside class="notes"> </aside>
            </section>
        </section>
        <section>
        <h2>Pros</h2>
        <ul>
          <li class="fragment">In source control.</li>
          <li class="fragment">Less differences between environments.</li>
          <li class="fragment">Self documenting (it's code!).</li>
          <li class="fragment">Refactoring.</li>
          <li class="fragment">Deterministic.</li>
          <li class="fragment">Prevents manual steps.</li>
          <li class="fragment">Fast and easy to configure up a new environment.</li>
          <li class="fragment">Easier to test server setup.</li>
        </ul>
        <aside class="notes"> </aside>
        </section>
        <section>
        <h2>Cons</h2>
        <ul>
          <li class="fragment">Unfamiliar to "old school operators".</li>
          <li class="fragment">Operations is unfamiliar to developers.</li>
          <li class="fragment">Startup cost.
          <ul>
            <li >Training</li>
            <li>Migrating</li>
          </ul>
          </li>
        </ul>
        <aside class="notes"> </aside>
        </section>

            <section>
            <h2>Bring up the boxes</h2>
            <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
vagrant up
            </code></pre>
            <aside class="notes">
            </aside>
            </section>
            <section>
            <h2>Layout</h2>
            <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
├── ansible.cfg
├── hosts
├── site.yml
├── group_vars
│   └── &lt;group name&gt;
├── host_vars
│   └── &lt;host name&gt;
├── roles
│   ├── &lt;role&gt;
│   │   ├── files
│   │       └── &lt;file&gt;
│   │   └── templates
│   │       └── &lt;template&gt;.j2
│   │   ├── handlers
│   │   │   └── main.yml
│   │   ├── tasks
│   │   │   └── main.yml
            </code></pre>
            <aside class="notes">Explain all folders and files.</aside>
            </section>
            <section>
            <h2>Play!</h2>
            <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
ansible-playbook site.yml
            </code></pre>
            <aside class="notes"> </aside>
            </section>
            <section>
            <h2>Facts</h2>
            <ul>
              <li>Ansible by default gathers “facts” about the machines under management.</li>
              <li>These facts can be accessed in Playbooks and in templates.</li>
            </ul>
            <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
ansible -m setup app1.local
            </code></pre>
            <aside class="notes"> </aside>
            </section>
            <section>
            <h2>The task</h2>
            <ul>
            <li>An app user 'devops', with:</li>
              <ul>
                <li>Home directory: /home/devops</li>
                <li>ssh-key</li>
               </ul>
            <li>A PostgresSQL database.</li>
            <li>Nginx as a reverse proxy.</li>
            <li>An init script installed as a service.</li>
            <li>Deploy an application that uses the provisioned infrastructure.</li>
            </ul>
            <aside class="notes"> </aside>
            </section>
            <section>
            <img width="449" height="510" src="img/architecture.png" alt="architecture">
            <aside class="notes"> </aside>
            </section>
            <section>
            <h2>Help!</h2>
            <a href="http://docs.ansible.com/list_of_all_modules.html">http://docs.ansible.com/list_of_all_modules.html</a>
            <aside class="notes"> </aside>
            </section>
            <section>
            <h2>Task1: Install and configure software</h2>
            <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
git checkout start
            </code></pre>
            <ul>
              <li>Modify roles/common/tasks/apt.yml.</li>
              <li>Install Vim.</li>
              <li>Insert the line 'filetype indent off' in /etc/vim/vimrc</li>
            </ul>
            <pre>
            </pre>
            <aside class="notes"> </aside>
            </section>
            <section>
            <h2>Progress</h2>
            <ul>
              <li>Installed software</li>
              <li>Manipulated files</li>
              <li>Created a user and set up a ssh-key</li>
              <li>Installed and configured a database and a db user</li>
              <li>Deployed an application to two appservers and enabled it as a service</li>
              <li>Migrated the database schema and fetched data from it through the application</li>
              <li>Set up a reverse proxy for automatic failover between the two appservers</li>
            </ul>
            <aside class="notes"> </aside>
            </section>
            <section>
            <h2>The Expand/Contract pattern</h2>
            <br>
            <table class="reveal" width="100%">
            <th>Expand</th>
            <th>Contract</th>
            <tr>
            <td width="50%" class="fragment">
            <ul>
              <li>Add tables</li>
              <li>Add columns</li>
              <li>Tweak indexes</li>
            </ul>
            </td>
            <td width="50%" class="fragment">
            <ul>
              <li>Remove tables</li>
              <li>Remove columns</li>
              <li>Remove/add constraints</li>
            </ul>
            </td>
            </tr>
            </table>
            </section>
            <aside class="notes"> </aside>
            </section>
            <section>
            <img width="449" height="510" src="img/architecture.png" alt="architecture">
            <aside class="notes"> </aside>
            </section>
            <section>
            <img width="449" height="510" src="img/pre-upgrade-db.png" alt="architecture">
            <aside class="notes"> </aside>
            </section>
            <section>
            <img width="449" height="510" src="img/upgrade1.png" alt="architecture">
            <aside class="notes"> </aside>
            </section>
            <section>
            <img width="449" height="510" src="img/upgrade2.png" alt="architecture">
            <aside class="notes"> </aside>
            </section>
            <section>
            <img width="449" height="510" src="img/post-upgrade-db.png" alt="architecture">
            <aside class="notes"> </aside>
            </section>
            <section>
            <img width="449" height="510" src="img/architecture.png" alt="architecture">
            <aside class="notes"> </aside>
            </section>
        <section>

            <h2>Cloud og virtuelle maskiner</h2>
            <ul>
            <li> Golden images (el. containers)</li>
            <li>Provisjonering av resten</li>
              <ul>
                <li>Konfigurasjonsendringer</li>
                <li>Deploy</li>
              </ul>
            </ul>
            <aside class="notes"> </aside>
            </section>

        <h2>Monitorering</h2>
        <img width="1000" height="529" src="img/monitoring.png" alt="architecture">
        </section>

        <section>
        <h2>Real developers carry beepers</h2>
        <img width="800" height="480" src="img/pagerduty.jpg" alt="architecture">
        </section>

        <section>
            <h1>Takk for meg!</h1>
            <img width="252" height="235" src="img/me_bart.png" alt="Stein Inge Morisbak">
            <p><a href="https://twitter.com/steinim">@steinim</a></p>
            <p><a href="mailto:stein.inge.morisbak@BEKK.no">stein.inge.morisbak@BEKK.no</a></p>
            <aside class="notes"> </aside>
        </section>

        <section>
        <h2>Slides & Repo</h2>
        <ul>
          <li><a href="http://steinim.github.io/slides/devops-i-praksis">http://steinim.github.io/slides/devops-i-praksis</a></li>
          <li><a href="https://github.com/steinim/devops-i-praksis">https://github.com/steinim/devops-i-praksis</a></li>
        </ul>
        <aside class="notes"> </aside>
        </section>

          <script src="../lib/js/head.min.js"></script>
          <script src="../js/reveal.min.js"></script>

          <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
              controls: true,
              progress: true,
              history: true,
              center: true,
              width: 1100,

              theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
              transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

              // Optional libraries used to extend on reveal.js
              dependencies: [
              { src: '../lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: '../plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: '../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: '../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: '../plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
              { src: '../plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
              // { src: '../plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
              // { src: '../plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
              ]
            });

          </script>
        </body>
      </html>
